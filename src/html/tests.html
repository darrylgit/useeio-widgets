<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>USEEIO Widgets - simple tests</title>
    <style>
        html {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
        }

        #root {
            margin: 25px auto;
            width: 75%
        }
    </style>
</head>

<body>

    <div id="root"></div>

    <script src="lib/d3.min.js"></script>
    <script src="lib/useeio_widgets.js"></script>
    <script>

        /*
        const model = useeio.model({
            endpoint: 'http://localhost/api',
            model: 'USEEIO',
        });
        */

        const model = useeio.model({
            endpoint: './api',
            model: 'USEEIO',
            asJsonFiles: true,
        });

        let root;
        const test = (header, fn) => {
            const div = document.createElement("div");
            root.appendChild(div)
            const span = document.createElement("span");
            span.textContent = "Test: " + header + " ... ";
            div.append(span);
            fn().then((r, err) => {
                if (r && !err) {
                    span.textContent = span.textContent + "OK";
                } else {
                    span.textContent = span.textContent + "ERROR";
                }
                console.log(header, ": ", r);
            });
        };

        window.onload = () => {
            root = document.getElementById("root");
            test("GET /sectors", () => model.sectors());
            test("GET /indicators", () => model.indicators());
            test("GET /demands", () => model.demands());
            test("GET /demand", () => model.demands()
                .then(demands => model.demand(demands[0].id)))
            test("GET matrix/U", () => model.matrix("U"));
            test("POST /calculate", () => {
                return model.demands()
                    .then(demands => model.demand(demands[0].id))
                    .then(demand => model.calculate({
                        perspective: "direct",
                        demand: demand,
                    }))
            });
        }
    </script>

</body>


</html>